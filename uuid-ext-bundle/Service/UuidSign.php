<?php namespace JavorUtil\UuidExt\UuidExtBundle\Service;class UuidSign{private $privateKeyId;private $publicKeyId;private $publicKeyString;public function __construct(){$rsa='LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0NCk1JSUNJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBZzhBTUlJQ0NnS0NBZ0VBek5ITm9XMHV5MkJRdjRhNjJnRjkNCjBUNXJBRTBkdU1DWW1QWHRnM1loTUYxNXZFKzIrWmk0NGR3elY3ZWwzdTFnVkNXR0ZxNm0zUVZGK1dSdlBwTkgNCnJxM0xReHdNempXUFZld252V1Z4ZUE2RjM3Y09mQitvVVVHdFZaZmVzVDgwVFNCVVhqTEhpWmtGT2hFSFZTSS8NCjFGTHR4djZFQ0dFL3JOV3c4a1pxdk50aTE1TUU0dGJQa1ZzQXNHdkNwR0NPNmtWZHlzT2JBbjAxdFR5NGdtb04NCnVhYjlJSTFidis4UTAzcUdKYlZrYkVIemNReGs5NXhGOHVENlpZVmg4RGlSWG1nNVRsaGlxQW9PaUV2a2hhZmUNClg2VS91am52SFhjQStIY3RLT0pwM3p3N2lwY1FYSHB6TlkxVUpnMVVjU091NWs5TFdOdnVFTXQ1L2xSM3NVRW4NCjRlOTFCT2FMQVJnQ1VVa09uaDlla1FsaU9OMVg5ekd3M2I2UU42VFBvMGdpaUFBeDhySVYvWkQrVG84L0VZZ0oNClg5OWpTRktYOFEwR0xkRFp5OWMvb0VDZWs2OGVSanpiR0JieEc3cFN5eXZPK1ZiVm5KOEtDK3lwTVZ1M0MwMjQNCjZ4UjZZYlBwRTZoNUJ6Yk1NNDMxRDQ2R3hXNEtyZTRkQmRQTW1rcVZGTFg5aWxpckFnZXdNOFFUNDJKVmxEejMNCm1CbUExdVQxeEY1L0hVYjFXcFRPTlJMMzl1aCtpbmN3VldKeFV1SzlrYlk5VngrS2UrOEtWMTJBS1pRK3A5dXINCjNhWEZzYVRkTWVCS0hNODZlNGpsWW1vbjhDT3NvMFRsbU1zU3lyQk9MbSt4akpHZEpPa3k4QjZjWEhVdlhoNUYNCmR4b3krcFdBdk1kb3lOVTJUZkFNN1Q4Q0F3RUFBUT09DQotLS0tLUVORCBQVUJMSUMgS0VZLS0tLS0=';$this->publicKeyId=openssl_pkey_get_public(base64_decode($rsa));}public function generateKey(){$keysize=4096;$this->privateKeyId=openssl_pkey_new(array('private_key_bits'=>$keysize));$this->publicKeyString=openssl_pkey_get_details($this->privateKeyId);$this->publicKeyString=$this->publicKeyString["key"];}public function storePrivateKey($privateKeyFile){openssl_pkey_export_to_file($this->privateKeyId,$privateKeyFile);}public function storePublicKey($publicKeyFile){if($this->publicKeyString===null){openssl_pkey_export_to_file($this->publicKeyId,$publicKeyFile);}else{echo $this->publicKeyString;file_put_contents($publicKeyFile,$this->publicKeyString);}}public function importPrivateKey($rsaKeyFilePath){$fp=fopen($rsaKeyFilePath,"r");$rsakey=fread($fp,8192);fclose($fp);$this->privateKeyId=openssl_get_privatekey($rsakey);}public function importPublicKey($rsaKeyFilePath){$fp=fopen($rsaKeyFilePath,"r");$rsakey=fread($fp,8192);fclose($fp);$this->publicKeyId=openssl_pkey_get_public($rsakey);}public function sign($data){openssl_sign(base64_encode($data),$signature,$this->privateKeyId,OPENSSL_ALGO_SHA512);return base64_encode($signature);}public function verify($data,$signature){return openssl_verify(base64_encode($data),base64_decode($signature),$this->publicKeyId,OPENSSL_ALGO_SHA512);}}
